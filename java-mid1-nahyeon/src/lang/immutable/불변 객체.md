# 기본형과 참조형의 공유

자바의 데이터 타입을 가장 크게 보면 기본형(Primitive Type)과 참조형(Reference Type)으로 나눌 수 있다.   
- **기본형**: 하나의 값을 여러 변수에서 절대로 공유하지 않는다.
- **참조형**: 하나의 객체를 참조값을 통해 여러 변수에서 공유할 수 있다.

```java
package lang.immutable.address;

public class PrimitiveMain {
    public static void main(String[] args) {
        //기본형은 절대로 같은 값을 공유하지 않는다.
        int a = 10;
        int b = a; //a -> b, 값 복사 후 대입
        System.out.println("a = " + a);
        System.out.println("b = " + b);

        b = 20;
        System.out.println("20 -> b");
        System.out.println("a = " + a);
        System.out.println("b = " + b);
    }
}
```
- 기본형 변수 `a` 와 `b` 는 절대로 하나의 값을 공유하지 않는다.
- `b = a` 라고 하면 **자바는 항상 값을 복사해서 대입** 한다. (`a`의 `10` 을 복사해서 `b` 에 전달)
- 결과적으로 `a` 와 `b` 는 둘다 `10` 이라는 똑같은 숫자의 값을 가진다. 
  - 하지만 `a`의 `10`과 `b`의 `10` 은 **복사된 완전히 다른 `10`** 
  - 메모리상에서도 `a`의 `10`과 `b`의 `10` 은 각각 별도로 존재한다.

<img alt="img.png" src="../img/img9.png" width="400"/>

```java
package lang.immutable.address;

public class RefMain_1 {
    public static void main(String[] args) {
        //참조형 변수는 하나의 인스턴스를 공유할 수 있다.
        Address a = new Address("서울");
        Address b = a;
        System.out.println("a = " + a);
        System.out.println("b = " + b);

        b.setValue("부산"); //b의 값을 부산으로 변경해야 함
        System.out.println("부산 -> b");
        System.out.println("a = " + a);
        System.out.println("b = " + b);
    }
}
```    

<img alt="img.png" src="../img/img8.png" width="400"/>

- 참조형 변수들은 같은 참조값을 통해 같은 인스턴스를 참조할 수 있다. 
- `b = a` 라고 하면 `a` 에 있는 참조값 `x001` 을 복사해서 `b` 에 전달한다. 
- 참조값을 복사해서 전달하므로 결과적으로 `a`, `b` 는 같은 `x001` 인스턴스를 참조한다.
- 참조형 변수는 참조값을 통해 같은 객체(인스턴스)를 공유할 수 있다.

# 공유 참조와 사이드 이펙트

`사이드 이펙트(Side Effect)` : 프로그래밍에서 어떤 계산이 주된 작업 외에 추가적인 부수 효과를 일으키는 것  
-> 디버깅이 어려워지고 코드의 안정성이 저하될 수 있다.

```java
b.setValue("부산"); //b의 값을 부산으로 변경해야 함
System.out.println("부산 -> b");
System.out.println("a = " + a); //같은 인스턴스를 참조하므로 사이드 이펙트 발생
System.out.println("b = " + b);
```

## 사이드 이펙트 해결 방안

`a`와 `b`가 서로 다른 인스턴스를 참조하도록 코드를 변경

## 여러 변수가 하나의 객체를 공유하는 것을 막을 방법은 없다

여러 변수가 하나의 객체를 공유하지 않으면 지금까지 설명한 문제들이 발생하지 않는다.  
그런데 여기서 문제가 있다. 하나의 객체를 여러 변수가 공유하지 않도록 강제로 막을 수 있는 방법이 없다는 것이다. 

  

```java
Address a = new Address("서울");
Address b = a; //참조값 대입을 막을 수 있는 방법이 없다.
```
`Address` 를 사용하는 개발자 입장에서 실수로 `b = a` 라고 해도 아무런 오류가 발생하지 않는다.  
왜냐하면 자바 문법상 `Address b = a` 와 같은 참조형 변수의 대입은 아무런 문제가 없기 때문이다.

다음과 같이 새로운 객체를 참조형 변수에 대입하든, 또는 기존 객체를 참조형 변수에 대입하든, 다음 두 코드 모두 자바 문법상 정상인 코드이다.
```java
Address b = new Address("서울") //새로운 객체 참조 Address b = a //기존 객체 공유 참조
```
참조값을 다른 변수에 대입하는 순간 여러 변수가 하나의 객체를 공유하게 된다. 

쉽게 이야기해서 **객체의 공유를 막을 수 있는 방법이 없다!**

기본형은 값이 절대로 공유되지 않지만, 참조형의 경우 자바 문법 상 오류가 없으므로 의도치 않은 사이드 이펙트가 생길 때도 있다.

